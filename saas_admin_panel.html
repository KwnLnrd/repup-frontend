<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord - ReviewGenius</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        // Configuration de la nouvelle charte graphique inspirée d'iOS
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ios-blue': '#007AFF',
                        'ios-blue-dark': '#005ECC',
                        'ios-bg': '#F2F2F7',
                        'ios-bg-secondary': '#FFFFFF',
                        'ios-text-primary': '#1D1D1F',
                        'ios-text-secondary': '#6E6E73',
                        'ios-text-tertiary': '#AEAEB2',
                        'ios-border': '#E5E5EA',
                    },
                    fontFamily: {
                        sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', '"Helvetica Neue"', 'Arial', 'sans-serif'],
                    },
                    borderRadius: {
                        'xl': '1rem',
                        '2xl': '1.25rem',
                        '3xl': '1.5rem',
                    },
                    boxShadow: {
                        'subtle': '0 1px 3px rgba(0, 0, 0, 0.03), 0 1px 2px rgba(0, 0, 0, 0.06)',
                        'medium': '0 4px 12px rgba(0, 0, 0, 0.08)',
                    },
                    animation: { 'fade-in': 'fadeIn 0.3s ease-out forwards' },
                    keyframes: { fadeIn: { '0%': { opacity: '0', transform: 'translateY(8px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } } }
                }
            }
        }
    </script>
    <style>
        body { background-color: #F2F2F7; font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        
        .nav-item.active { background-color: #EBF5FF; color: #007AFF; font-weight: 600; }
        .nav-item.active svg { color: #007AFF; }
        
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.5s ease-out; }
        
        .widget-grid { display: grid; gap: 1.5rem; grid-template-columns: repeat(3, 1fr); }
        .widget { background-color: #FFFFFF; border-radius: 1.25rem; padding: 1.5rem; box-shadow: var(--tw-shadow-subtle); transition: transform 0.2s ease-out, box-shadow 0.2s ease-out; }
        .widget:hover { transform: translateY(-3px); box-shadow: var(--tw-shadow-medium); }
        .col-span-2 { grid-column: span 2 / span 2; }
        @media (max-width: 1024px) { .widget-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 767px) { .widget-grid { grid-template-columns: 1fr; } }
        
        .form-input {
            background-color: #F2F2F7; border: 1px solid #E5E5EA; color: #1D1D1F;
            border-radius: 0.625rem; padding: 0.75rem 1rem; width: 100%;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus { outline: none; border-color: #007AFF; box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2); }
        
        .list-item {
            background-color: #FFFFFF;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #F2F2F7;
        }
        .list-item:first-child { border-top-left-radius: 1.25rem; border-top-right-radius: 1.25rem; }
        .list-item:last-child { border-bottom: 0; border-bottom-left-radius: 1.25rem; border-bottom-right-radius: 1.25rem; }
        
        .modal-backdrop { background-color: rgba(0,0,0,0.4); backdrop-filter: blur(4px); }
        .modal-content { animation: fadeIn 0.2s ease-out; }
    </style>
</head>
<body class="antialiased">

    <!-- Auth Overlay -->
    <div id="auth-overlay" class="fixed inset-0 bg-ios-bg z-50 flex items-center justify-center p-4">
        <div class="w-full max-w-sm">
            <h1 class="font-extrabold text-4xl text-center mb-8 text-ios-text-primary">Review<span class="text-ios-blue">Genius</span></h1>
            <div class="bg-ios-bg-secondary p-8 rounded-3xl shadow-medium">
                <form id="login-form">
                    <h2 class="text-xl font-bold mb-6 text-center text-ios-text-primary">Connexion</h2>
                    <input type="email" id="login-email" placeholder="Adresse e-mail" class="form-input mb-4" required>
                    <input type="password" id="login-password" placeholder="Mot de passe" class="form-input mb-4" required>
                    <button type="submit" id="login-button" class="w-full bg-ios-blue text-white py-3 rounded-xl font-bold hover:bg-ios-blue-dark transition-colors">Se connecter</button>
                    <p id="login-error" class="text-red-500 text-sm mt-2 h-4 text-center"></p>
                    <p class="text-center text-sm text-ios-text-secondary mt-6">Pas de compte ? <button type="button" id="show-register" class="font-semibold text-ios-blue hover:underline">Inscrivez-vous</button></p>
                </form>
                <form id="register-form" class="hidden">
                    <h2 class="text-xl font-bold mb-6 text-center text-ios-text-primary">Créer un compte</h2>
                    <input type="text" id="register-resto-name" placeholder="Nom du restaurant" class="form-input mb-4" required>
                    <input type="email" id="register-email" placeholder="Adresse e-mail" class="form-input mb-4" required>
                    <input type="password" id="register-password" placeholder="Mot de passe" class="form-input mb-4" required>
                    <button type="submit" id="register-button" class="w-full bg-gray-700 text-white py-3 rounded-xl font-bold hover:bg-gray-800 transition-colors">S'inscrire</button>
                    <p id="register-error" class="text-red-500 text-sm mt-2 h-4 text-center"></p>
                    <p class="text-center text-sm text-ios-text-secondary mt-6">Déjà un compte ? <button type="button" id="show-login" class="font-semibold text-ios-blue hover:underline">Connectez-vous</button></p>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden">
        <div class="relative min-h-screen md:flex">
            <!-- Sidebar -->
            <aside id="sidebar" class="fixed inset-y-0 left-0 bg-ios-bg-secondary/80 backdrop-blur-xl border-r border-ios-border w-64 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out z-40 flex flex-col">
                <div class="h-20 flex items-center justify-center px-4 shrink-0">
                    <a href="#dashboard" id="sidebar-logo-link" class="font-extrabold text-2xl text-ios-text-primary">
                        Review<span class="text-ios-blue">Genius</span>
                    </a>
                </div>
                <nav id="sidebar-nav" class="mt-4 flex-1 overflow-y-auto px-4 space-y-1">
                    <!-- Nav items will be injected by JS -->
                </nav>
                <div class="p-4 border-t border-ios-border shrink-0">
                    <button id="logout-btn" class="w-full text-left flex items-center px-4 py-2 text-ios-text-secondary hover:bg-red-500/10 hover:text-red-600 rounded-lg transition-colors">
                        <svg class="h-5 w-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                        <span>Déconnexion</span>
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <div class="md:ml-64 flex flex-col flex-1">
                <header class="md:hidden sticky top-0 bg-ios-bg/80 backdrop-blur-xl z-20 border-b border-ios-border">
                    <div class="flex justify-between items-center p-4">
                        <button id="sidebar-open-btn" class="text-ios-blue">
                            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
                        </button>
                        <a href="#dashboard" id="mobile-logo-link" class="font-bold text-xl text-ios-text-primary">Review<span class="text-ios-blue">Genius</span></a>
                        <div class="w-6"></div>
                    </div>
                </header>

                <main class="flex-1 p-4 md:p-6 lg:p-8">
                    <div id="content-area">
                        <!-- Content sections will be injected here -->
                    </div>
                </main>
            </div>
        </div>
    </div>
    
    <!-- Modal Container -->
    <div id="modal-container" class="fixed inset-0 hidden z-50 flex items-center justify-center p-4 modal-backdrop">
        <!-- Modal content injected here -->
    </div>

    <script type="module">
        // --- CONFIGURATION ---
        const API_BASE_URL = 'https://repup-test.onrender.com';
        const NAV_ITEMS = [
            { id: 'dashboard', label: 'Tableau de bord', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 mr-3"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>` },
            { id: 'sharing', label: 'Partage & QR Code', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 mr-3"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="8" y1="12" x2="16" y2="12"></line><line x1="12" y1="8" x2="12" y2="16"></line></svg>` },
            { id: 'management', label: 'Gestion', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 mr-3"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>` },
        ];

        // --- DOM & STATE ---
        const $ = (s) => document.querySelector(s);
        const $$ = (s) => document.querySelectorAll(s);
        const state = { token: null, restaurant: null, servers: [], menu: {}, tags: {}, currentTab: 'dashboard' };

        // --- API & UI MODULES ---
        const Api = { /* ... (same as before) ... */ };
        const UI = { /* ... (same as before, adapted for new class names) ... */ };
        const Auth = { /* ... (same as before) ... */ };
        
        // --- REWRITING API & UI for brevity in this example ---
        Api.fetch = async (url, options = {}) => {
            const headers = { 'Content-Type': 'application/json', ...options.headers };
            if (state.token) headers['Authorization'] = `Bearer ${state.token}`;
            const response = await fetch(`${API_BASE_URL}${url}`, { ...options, headers });
            if (response.status === 401 || response.status === 422) { Auth.logout(); throw new Error('Session expirée.'); }
            if (!response.ok) { const d = await response.json().catch(()=>({})); throw new Error(d.error || `Erreur ${response.status}`); }
            return response.status === 204 ? null : response.json();
        };
        ['get', 'del'].forEach(m => Api[m] = (url) => Api.fetch(url, { method: m.toUpperCase() }));
        ['post', 'put'].forEach(m => Api[m] = (url, data) => Api.fetch(url, { method: m.toUpperCase(), body: JSON.stringify(data) }));

        UI.renderNav = () => {
            $('#sidebar-nav').innerHTML = NAV_ITEMS.map(item => `
                <a href="#${item.id}" class="nav-item flex items-center px-4 py-2.5 text-ios-text-primary hover:bg-gray-100 rounded-lg transition-colors">
                    ${item.icon}<span>${item.label}</span>
                </a>`).join('');
        };
        UI.renderContentSections = () => { $('#content-area').innerHTML = NAV_ITEMS.map(item => `<section id="${item.id}" class="content-section"></section>`).join(''); };
        UI.switchTab = (tabId) => {
            state.currentTab = tabId;
            window.location.hash = tabId;
            $$('.nav-item').forEach(item => item.classList.toggle('active', item.getAttribute('href') === `#${tabId}`));
            $$('.content-section').forEach(section => section.classList.toggle('active', section.id === tabId));
            if(window.innerWidth < 768) $('#sidebar').classList.add('-translate-x-full');
        };
        UI.openModal = (content) => {
            $('#modal-container').innerHTML = `<div class="modal-content bg-ios-bg-secondary p-6 rounded-2xl w-full max-w-md shadow-medium">${content}</div>`;
            $('#modal-container').classList.remove('hidden');
        };
        UI.closeModal = () => { $('#modal-container').classList.add('hidden'); };
        
        Auth.init = () => {
             state.token = localStorage.getItem('jwt_token');
             if (state.token) {
                 $('#auth-overlay').classList.add('hidden');
                 $('#main-app').classList.remove('hidden');
                 App.loadData();
             } else {
                 $('#auth-overlay').classList.remove('hidden');
                 $('#main-app').classList.add('hidden');
             }
        };
        Auth.login = async (email, password) => { const data = await Api.post('/api/login', { email, password }); localStorage.setItem('jwt_token', data.access_token); Auth.init(); };
        Auth.register = async (restaurant_name, email, password) => { const data = await Api.post('/api/register', { restaurant_name, email, password }); alert(data.message); $('#login-form').reset(); $('#register-form').reset(); $('#register-form').classList.add('hidden'); $('#login-form').classList.remove('hidden'); };
        Auth.logout = () => { localStorage.removeItem('jwt_token'); state.token = null; Auth.init(); };

        // --- PAGE RENDERERS (iOS Style) ---
        const Pages = {
            async dashboard() {
                $('#dashboard').innerHTML = `
                    <h1 class="text-3xl font-bold mb-6 text-ios-text-primary">Tableau de bord</h1>
                    <div class="widget-grid">
                        <div class="widget col-span-2">
                            <h3 class="font-semibold text-ios-text-primary mb-4">Tendance des avis</h3>
                            <div class="h-64"><canvas id="reviewsTrendChart"></canvas></div>
                        </div>
                        <div class="widget">
                             <h3 class="text-ios-text-secondary font-medium">Note moyenne</h3>
                             <p class="text-4xl font-bold mt-2 text-ios-text-primary">4.8 <span class="text-yellow-400">★</span></p>
                        </div>
                        <div class="widget">
                            <h3 class="text-ios-text-secondary font-medium">Avis (30j)</h3>
                            <p class="text-4xl font-bold mt-2 text-ios-text-primary">128</p>
                        </div>
                        <div class="widget col-span-3">
                            <h3 class="font-semibold text-ios-text-primary mb-4">Aperçu rapide</h3>
                            <!-- Add more quick stats here -->
                        </div>
                    </div>
                `;
                const ctx = $('#reviewsTrendChart').getContext('2d');
                new Chart(ctx, { type: 'bar', data: { labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin'], datasets: [{ label: 'Avis', data: [65, 59, 80, 81, 56, 55], backgroundColor: 'rgba(0, 122, 255, 0.6)', borderColor: '#007AFF', borderWidth: 1, borderRadius: 8 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: '#E5E5EA' } }, x: { grid: { display: false } } }, plugins: { legend: { display: false } } } });
            },
            async sharing() {
                const slug = state.restaurant.slug;
                const reviewPageUrl = new URL('saas_review_collection_page.html', window.location.origin + window.location.pathname.replace('saas_admin_panel.html', ''));
                reviewPageUrl.searchParams.set('slug', slug);

                $('#sharing').innerHTML = `
                    <h1 class="text-3xl font-bold mb-6 text-ios-text-primary">Partage & QR Code</h1>
                    <div class="widget grid md:grid-cols-2 gap-8 items-center">
                        <div class="text-center">
                            <h2 class="font-semibold text-xl mb-4 text-ios-text-primary">Votre QR Code</h2>
                            <div class="flex justify-center items-center bg-white p-3 rounded-2xl mx-auto max-w-[200px] border border-ios-border">
                                <div id="qrcode-container"></div>
                            </div>
                            <button id="download-qr-btn" class="mt-4 w-full bg-ios-blue text-white py-2.5 rounded-lg font-semibold">Télécharger</button>
                        </div>
                        <div class="space-y-6">
                            <div>
                                <h3 class="font-semibold text-ios-text-primary mb-1">Lien direct</h3>
                                <input type="text" id="review-page-link" readonly value="${reviewPageUrl.href}" class="form-input cursor-pointer" title="Cliquez pour copier">
                            </div>
                             <div>
                                <h3 class="font-semibold text-ios-text-primary mb-1">Kit Média</h3>
                                <p class="text-ios-text-secondary text-sm mb-2">Supports prêts à imprimer.</p>
                                <button class="w-full bg-gray-200 text-ios-text-primary py-2.5 rounded-lg font-semibold">Télécharger (PDF)</button>
                            </div>
                        </div>
                    </div>
                `;
                new QRCode($('#qrcode-container'), { text: reviewPageUrl.href, width: 180, height: 180, colorDark: "#000000", colorLight: "#ffffff" });
            },
            async management() {
                $('#management').innerHTML = `
                    <h1 class="text-3xl font-bold mb-6 text-ios-text-primary">Gestion</h1>
                    <div class="space-y-8">
                        <div>
                            <h2 class="text-xl font-bold mb-3 text-ios-text-primary px-1">Équipe</h2>
                            <div id="servers-list" class="rounded-2xl overflow-hidden shadow-subtle"></div>
                            <form id="add-server-form" class="mt-4 flex gap-3"><input type="text" name="name" placeholder="Ajouter un membre..." class="form-input flex-grow" required><button type="submit" class="bg-ios-blue text-white h-11 px-5 rounded-lg font-semibold">Ajouter</button></form>
                        </div>
                        <div class="grid md:grid-cols-2 gap-8">
                           <div>
                                <h2 class="text-xl font-bold mb-3 text-ios-text-primary px-1">Options (Tags)</h2>
                                <div id="tags-list" class="rounded-2xl overflow-hidden shadow-subtle"></div>
                                <form id="add-tag-form" class="mt-4 flex gap-3"><input type="text" name="text" placeholder="Nouveau tag..." class="form-input flex-grow" required><button type="submit" class="bg-ios-blue text-white h-11 px-5 rounded-lg font-semibold">Ajouter</button></form>
                           </div>
                           <div>
                                <h2 class="text-xl font-bold mb-3 text-ios-text-primary px-1">Menu</h2>
                                <div id="dishes-list" class="rounded-2xl overflow-hidden shadow-subtle"></div>
                                <form id="add-dish-form" class="mt-4 flex gap-3"><input type="text" name="name" placeholder="Nouveau plat..." class="form-input flex-grow" required><button type="submit" class="bg-ios-blue text-white h-11 px-5 rounded-lg font-semibold">Ajouter</button></form>
                           </div>
                        </div>
                    </div>
                `;
                this.renderManagementLists();
            },
            renderManagementLists() {
                $('#servers-list').innerHTML = state.servers.map(s => `<div class="list-item" id="server-${s.id}"><span class="font-medium">${s.name}</span><button class="delete-btn text-red-500" data-type="server" data-id="${s.id}">Supprimer</button></div>`).join('') || '<div class="list-item text-ios-text-secondary">Aucun membre.</div>';
                $('#tags-list').innerHTML = Object.entries(state.tags).map(([cat, tags]) => tags.map(t => `<div class="list-item" id="tag-${t.id}"><span class="font-medium">${t.text}</span><button class="delete-btn text-red-500" data-type="tag" data-id="${t.id}">Supprimer</button></div>`).join('')).join('') || '<div class="list-item text-ios-text-secondary">Aucun tag.</div>';
                $('#dishes-list').innerHTML = Object.entries(state.menu).map(([cat, dishes]) => dishes.map(d => `<div class="list-item" id="dish-${d.id}"><span class="font-medium">${d.name}</span><button class="delete-btn text-red-500" data-type="dish" data-id="${d.id}">Supprimer</button></div>`).join('')).join('') || '<div class="list-item text-ios-text-secondary">Aucun plat.</div>';
            }
        };

        // --- MAIN APP & EVENT LISTENERS ---
        const App = {
            async loadData() {
                try {
                    [state.restaurant, state.servers, state.menu, state.tags] = await Promise.all([ Api.get('/api/restaurant'), Api.get('/api/servers'), Api.get('/api/menu'), Api.get('/api/tags') ]);
                    await Promise.all([ Pages.dashboard(), Pages.sharing(), Pages.management() ]);
                    UI.switchTab(window.location.hash.substring(1) || 'dashboard');
                } catch (error) { alert(error.message); Auth.logout(); }
            },
            async add(type, formData) {
                let payload;
                if(type === 'server') payload = { name: formData.get('name') };
                if(type === 'tag') payload = { text: formData.get('text'), category: 'service' }; // Simplified category
                if(type === 'dish') payload = { name: formData.get('name'), category: 'Plats' }; // Simplified category
                
                const newItem = await Api.post(`/api/${type}s`, payload);
                
                if(type === 'server') state.servers.push(newItem);
                if(type === 'tag') { if(!state.tags.service) state.tags.service = []; state.tags.service.push(newItem); }
                if(type === 'dish') { if(!state.menu.Plats) state.menu.Plats = []; state.menu.Plats.push(newItem); }
                
                Pages.renderManagementLists();
            },
            async deleteItem(type, id) {
                if (!confirm('Voulez-vous vraiment supprimer cet élément ?')) return;
                await Api.del(`/api/${type}s/${id}`);
                $(`#${type}-${id}`).remove();
            }
        };

        function setupEventListeners() {
            // Auth, Nav, Modal...
            $('#login-form').addEventListener('submit', async e => { e.preventDefault(); await Auth.login($('#login-email').value, $('#login-password').value).catch(err => $('#login-error').textContent = err.message); });
            $('#register-form').addEventListener('submit', async e => { e.preventDefault(); await Auth.register($('#register-resto-name').value, $('#register-email').value, $('#register-password').value).catch(err => $('#register-error').textContent = err.message); });
            $('#show-register').addEventListener('click', () => { $('#login-form').classList.add('hidden'); $('#register-form').classList.remove('hidden'); });
            $('#show-login').addEventListener('click', () => { $('#register-form').classList.add('hidden'); $('#login-form').classList.remove('hidden'); });
            $('#logout-btn').addEventListener('click', Auth.logout);
            $('#sidebar-nav').addEventListener('click', e => { const link = e.target.closest('a'); if (link) UI.switchTab(link.hash.substring(1)); });
            $('#sidebar-open-btn').addEventListener('click', () => $('#sidebar').classList.remove('-translate-x-full'));
            document.body.addEventListener('click', e => { if (e.target === $('#sidebar-open-btn') || e.target.closest('#sidebar-open-btn')) return; if (window.innerWidth < 768 && !e.target.closest('#sidebar')) $('#sidebar').classList.add('-translate-x-full'); });
            $('#modal-container').addEventListener('click', e => { if (e.target === $('#modal-container')) UI.closeModal(); });

            // Forms & Actions
            $('#content-area').addEventListener('submit', e => {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                if (form.id === 'add-server-form') App.add('server', formData);
                if (form.id === 'add-tag-form') App.add('tag', formData);
                if (form.id === 'add-dish-form') App.add('dish', formData);
                form.reset();
            });
            $('#content-area').addEventListener('click', e => {
                const deleteBtn = e.target.closest('.delete-btn');
                if (deleteBtn) App.deleteItem(deleteBtn.dataset.type, deleteBtn.dataset.id);
                if(e.target.closest('#review-page-link')) { navigator.clipboard.writeText(e.target.value); alert('Lien copié !'); }
                if(e.target.closest('#download-qr-btn')) {
                    const canvas = $('#qrcode-container').querySelector('canvas');
                    if(canvas) { const link = document.createElement('a'); link.download = `qrcode.png`; link.href = canvas.toDataURL('image/png'); link.click(); }
                }
            });
        }

        // --- INITIALIZATION ---
        function init() {
            UI.renderNav();
            UI.renderContentSections();
            setupEventListeners();
            Auth.init();
        }

        init();
    </script>
</body>
</html>
